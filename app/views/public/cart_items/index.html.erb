<div>
	<h5>ショッピングカート</h5>
</div>
<% @total_price = 0 %>
<% if current_customer.cart_items.present? %>
  <div>
  	<%= link_to "カートを空にする", destroy_all_public_cart_items_path, method: :delete, "data-confirm" => "本当に空にしますか？" %>
  </div>

  <table class='table'>
    <thead>
      <tr>
        <th colspan="3">商品名</th>
        <th>単価(税込)</th>
        <th>数量</th>
        <th>小計</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @cart_items.each do |cart_item| %>
        <tr>
          <td colspan="3">
          	<%= image_tag cart_item.item.image, size: "50x30", class: "img-fluid", alt: "image" %>
            <%= cart_item.item.name %>
          </td>
          <td>
            <% @price_taxin = cart_item.item.add_tax_price %>
            <%= @price_taxin %>
          </td>
          <td>
          	<%= form_with model: cart_item, url: public_cart_item_path(cart_item), method: :patch, local: true do |f| %>
      				<%#<%= f.hidden_field :item_id, :value => @item.id %>
      				<%= f.select :amount, [[1, 1], [2, 2], [3, 3], [4, 4], [5, 5], [6, 6], [7, 7], [8, 8], [9, 9], [10, 10]], { selected: cart_item.amount } %>
      				<%= f.submit '変更', class: 'btn btn-success' %>
  					<% end %>
          </td>
          <td>
            <% @subtotal = @price_taxin * cart_item.amount %>
            <%= @subtotal %>
            <% @total_price += @subtotal %>
          </td>
          <td><%= link_to '削除する', @cart_item, method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn btn-sm btn-danger"%></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div>
  	<%= link_to '買い物を続ける', public_items_path, class: "btn btn-sm btn-primary" %>
  </div>

  <div>
  	<span>合計金額</span>
  	<span><%= @total_price %></span>
  </div>

  <div>
  	<%= link_to '情報入力に進む', new_public_order_path, class: "btn btn-sm btn-success" %>
  </div>
<% else %>
  <p>カートには何も入っていません</p>
<% end %>